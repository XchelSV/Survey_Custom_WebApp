extends layout

block content
  style.
    body {
        background-color: #eceff1;
    }

  nav(style='height:95px',ng-controller='indexController',ng-class='color').animated.fadeInDown
    .nav-wrapper
      a.brand-logo.center(href='#')
        img.responsive-img(src='/images/userLogo/#{user_id}.png', alt='')
      ul.right.hide-on-med-and-down(style='margin-top:1%')
        li
          a(href='#')
            i.material-icons search
        li
          a(href='/logout')
            i.material-icons play_for_work


      

    
  .container(ng-controller='indexController',style='margin-top:3%')
      .row.animated.fadeIn
        each val,index in surveys
          .col.s12.m6
              .card.medium
                .card-image
                  img(src='/images/4.png')
                  span.card-title= val.nombre
                .card-content
                  p= val.descripcion
                    
                .card-action
                  a.dropdown-button.btn(href='#', data-activates='dropdown'+index, ng-class='color') Opciones

                  // Dropdown Structure
                  ul(id='dropdown'+index).dropdown-content
                    li
                      a(href='/survey/'+val._id) Ver 
                    li
                      a(href='#!') Editar
                    li.divider
                    li
                      a.modal-trigger(href='#modal1', ng-click='obtain_graphs_data("#{val._id}")') Estadísticos
                    li
                      a(ng-click='makeQR("#{val._id}")') Código QR


      #qr_modal.modal
        .modal-content
          .row
            .col.s12
              h4(align='center').thin Escanea el código QR de la Encuesta
          .row(style='margin-top:6%')
            .col.s4.offset-s4
              #qrcode
            

        .modal-footer
          a.modal-action.modal-close.waves-effect.waves-green.btn-flat(href='#!') Agree

      
      // Modal Structure
      .modal(id='modal1')
          .modal-content
            .row
              .col.s6
                h4.thin {{survey.nombre}}
              .col.s4.offset-s1
                select(ng-model='question_number_id',ng-change='show_graphs_by_question()')
                    option(value='', disabled, selected) Selecciona una Pregunta
                    option(ng-repeat='question in survey.preguntas',value='{{question._id}}' ,on-finish-render="ngRepeatFinished") Pregunta {{$index + 1}}

            .row(style='margin-top:-5%',ng-hide='div_survey_details')
              .col.s12
                p {{question_name}}
            .row#canvas_div
              canvas#myChart(width='400', height='145',ng-hide='div_survey_details')
            .row(ng-show='div_survey_details')
              .row
                .col.s12
                  h5.thin Nombre de la encuesta: 
                    
                      strong {{survey.nombre}}

              .row(style='margin-top:-5%')
                .col.s12
                  h5.thin Fecha de Creación: 
                    
                      strong {{date}}

              .row(style='margin-top:-5%')
                .col.s12
                  h5.thin Total de Respuestas: 
                    
                      strong {{survey_answers.length}}

              .row(style='margin-top:-5%')
                .col.s12
                  h5.thin Última Respuesta: 
                    
                      strong {{last_answer_date}}





          .modal-footer
            a.modal-action.modal-close.waves-effect.waves-green.btn-flat(href='#!') Agree




                    
  
  .fixed-action-btn(style='bottom: 45px; right: 24px;')
      a.btn-floating.btn-large.red.waves-effect.waves-light(href='/survey/new')
        i.large.material-icons add


  script.
    $('.dropdown-button').dropdown({
        inDuration: 300,
        outDuration: 225,
        constrain_width: false, // Does not change width of dropdown to that of the activator
        hover: true, // Activate on hover
        gutter: 0, // Spacing from edge
        belowOrigin: false, // Displays dropdown below the button
        alignment: 'left' // Displays dropdown with edge aligned to the left of button
      });


  script.
    var surveys = !{JSON.stringify(surveys)};
    moment.locale("es");

  block footer
